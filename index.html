<body>

<script type="module">

import Component from "./js/Component.js";
import InputComponent from "./js/InputComponent.js";
import SelectComponent from "./js/SelectComponent.js";
import TickComponent from "./js/TickComponent.js";

function createComponent(type, data) {
	switch (type) {
	case "checkbox":
	case "radio":
		return new TickComponent(type, data);

	case "date":
	case "email":
	case "file":
	case "range":
	case "url":
		return new InputComponent(type, data);

	case "select":
		return new SelectComponent(data);

	default:
		return null;
	}
}

function generate(string) {
	let json = JSON.parse(string);
	if (!json)
		return;

	let formElement = document.createElement("form");
	formElement.setAttribute("action", json.action);
	formElement.setAttribute("method", json.method);
	formElement.setAttribute("enctype", "multipart/form-data");

	let components = [];
	for (let item of json.items) {
		let type = item.type;
		item.type = null;

		let condition = item.condition;
		item.condition = null;

		let component = createComponent(type, item);

		if (condition && !isNaN(condition.index)) {
			let conditionComponent = components[condition.index];
			conditionComponent.addEventListener(Component.Event.ValueChanged, event => {
				if (JSON.stringify(conditionComponent.value) === JSON.stringify(condition.value))
					conditionComponent.element.insertAdjacentElement("afterend", component.element);
				else
					component.element.remove();
			});
		} else
			formElement.appendChild(component.element);

		components.push(component);
	}

	formElement.appendChild(document.createElement("button")).textContent = "Submit";

	return formElement;
}

document.body.appendChild(generate(JSON.stringify({
})));

</script>

</body>
